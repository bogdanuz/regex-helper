<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RegexHelper v4.0 - Test Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: #161b22;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #58a6ff;
        }

        .header p {
            color: #8b949e;
            font-size: 14px;
        }

        .test-selector {
            background: #161b22;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        .test-selector h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #c9d1d9;
        }

        .test-item {
            background: #0d1117;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .test-item:hover {
            border-color: #58a6ff;
            background: #161b22;
        }

        .test-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #58a6ff;
        }

        .test-info {
            flex: 1;
        }

        .test-name {
            font-weight: 600;
            color: #c9d1d9;
            margin-bottom: 4px;
        }

        .test-description {
            font-size: 13px;
            color: #8b949e;
        }

        .test-meta {
            display: flex;
            gap: 12px;
            font-size: 12px;
            color: #8b949e;
        }

        .test-badge {
            background: #21262d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .controls {
            background: #161b22;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #21262d;
            color: #c9d1d9;
            border: 1px solid #30363d;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #30363d;
            border-color: #8b949e;
        }

        .btn-primary {
            background: #238636;
            border-color: #2ea043;
            color: #fff;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .selected-info {
            flex: 1;
            font-size: 14px;
            color: #8b949e;
        }

        .results {
            background: #161b22;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #30363d;
            margin-bottom: 20px;
        }

        .results h2 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #c9d1d9;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .stat {
            background: #0d1117;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #30363d;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 12px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat.total .stat-number { color: #58a6ff; }
        .stat.passed .stat-number { color: #3fb950; }
        .stat.failed .stat-number { color: #f85149; }

        .logs {
            background: #0d1117;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #30363d;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .logs:empty::before {
            content: '–õ–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤...';
            color: #8b949e;
            font-style: italic;
        }

        .log-success { color: #3fb950; }
        .log-error { color: #f85149; }
        .log-info { color: #58a6ff; }
        .log-muted { color: #8b949e; }

        .spinner {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: #58a6ff;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #0d1117;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üß™ RegexHelper v4.0 - Test Runner</h1>
            <p>–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ ‚Ä¢ –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ ‚Ä¢ –ú–∏–Ω–∏–º–∞–ª–∏–∑–º</p>
        </div>

        <!-- Test Selector -->
        <div class="test-selector">
            <h2>üìã –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞</h2>
            <div id="testList"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn btn-primary" id="runBtn">
                <span id="runIcon">‚ñ∂</span>
                <span id="runText">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã</span>
            </button>
            <button class="btn" id="copyBtn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏</button>
            <button class="btn" id="clearBtn">üóë –û—á–∏—Å—Ç–∏—Ç—å</button>
            <div class="selected-info" id="selectedInfo">
                –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞
            </div>
        </div>

        <!-- Results -->
        <div class="results">
            <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div class="stats">
                <div class="stat total">
                    <div class="stat-number" id="totalTests">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ</div>
                </div>
                <div class="stat passed">
                    <div class="stat-number" id="passedTests">0</div>
                    <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ</div>
                </div>
                <div class="stat failed">
                    <div class="stat-number" id="failedTests">0</div>
                    <div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div>
                </div>
            </div>
            <div class="logs" id="logs"></div>
        </div>
    </div>

    <script type="module">
        import { TEST_SUITES } from './tests/test-config.js';

        let selectedTests = new Set();
        let allTestResults = [];
        let isRunning = false;

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É (–ø–æ –¥–∞—Ç–µ —É–±—ã–≤–∞–Ω–∏–µ)
        const sortedSuites = [...TEST_SUITES].sort((a, b) => {
            return new Date(b.date) - new Date(a.date);
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            renderTestList();
            setupEventListeners();
            updateSelectedInfo();
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
        function renderTestList() {
            const container = document.getElementById('testList');
            
            if (sortedSuites.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</p></div>';
                return;
            }

            container.innerHTML = sortedSuites.map(suite => `
                <div class="test-item">
                    <input 
                        type="checkbox" 
                        id="test-${suite.id}" 
                        ${suite.enabled ? 'checked' : ''}
                        data-suite-id="${suite.id}"
                    >
                    <div class="test-info">
                        <div class="test-name">${suite.name}</div>
                        <div class="test-description">${suite.description}</div>
                        <div class="test-meta">
                            <span class="test-badge">~${suite.estimatedTests} —Ç–µ—Å—Ç–æ–≤</span>
                            <span class="test-badge">v${suite.version}</span>
                            <span class="test-badge">${suite.date}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ Set –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            sortedSuites.forEach(suite => {
                if (suite.enabled) {
                    selectedTests.add(suite.id);
                }
            });
        }

        // Event listeners
        function setupEventListeners() {
            // –ß–µ–∫–±–æ–∫—Å—ã
            document.getElementById('testList').addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    const suiteId = e.target.dataset.suiteId;
                    if (e.target.checked) {
                        selectedTests.add(suiteId);
                    } else {
                        selectedTests.delete(suiteId);
                    }
                    updateSelectedInfo();
                }
            });

            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('runBtn').addEventListener('click', runTests);
            document.getElementById('copyBtn').addEventListener('click', copyLogs);
            document.getElementById('clearBtn').addEventListener('click', clearResults);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ –æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
        function updateSelectedInfo() {
            const count = selectedTests.size;
            const totalTests = sortedSuites
                .filter(s => selectedTests.has(s.id))
                .reduce((sum, s) => sum + s.estimatedTests, 0);

            const info = document.getElementById('selectedInfo');
            if (count === 0) {
                info.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞';
            } else {
                info.textContent = `–í—ã–±—Ä–∞–Ω–æ: ${count} —Ñ–∞–π–ª(–∞) ‚Ä¢ ~${totalTests} —Ç–µ—Å—Ç–æ–≤`;
            }
        }

        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
        async function runTests() {
            if (isRunning) return;
            if (selectedTests.size === 0) {
                log('error', '–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–µ—Å—Ç');
                return;
            }

            isRunning = true;
            updateRunButton(true);
            clearResults();

            const startTime = Date.now();
            log('info', '‚ïê'.repeat(50));
            log('info', `üöÄ –ó–∞–ø—É—Å–∫ ${selectedTests.size} —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤...`);
            log('info', '‚ïê'.repeat(50));

            allTestResults = [];

            for (const suiteId of selectedTests) {
                const suite = sortedSuites.find(s => s.id === suiteId);
                if (!suite) continue;

                log('info', `\nüì¶ –ó–∞–≥—Ä—É–∑–∫–∞: ${suite.name}`);

                try {
                    // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç–µ—Å—Ç–∞
                    const module = await import(`./tests/${suite.file}`);
                    log('success', `‚úÖ ${suite.file} –∑–∞–≥—Ä—É–∂–µ–Ω`);
                } catch (error) {
                    log('error', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${suite.file}: ${error.message}`);
                }
            }

            const duration = Date.now() - startTime;
            
            log('info', '\n' + '‚ïê'.repeat(50));
            log('info', `‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ ${duration}ms`);
            log('info', '‚ïê'.repeat(50));

            setTimeout(() => {
                updateRunButton(false);
                isRunning = false;
            }, 1000);
        }

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(type, message) {
            const logsEl = document.getElementById('logs');
            const line = document.createElement('div');
            
            const timestamp = new Date().toLocaleTimeString('ru-RU');
            const prefix = {
                'success': '‚úÖ',
                'error': '‚ùå',
                'info': '‚ÑπÔ∏è',
                'muted': '‚Ä¢'
            }[type] || '';

            line.className = `log-${type}`;
            line.textContent = message;
            
            logsEl.appendChild(line);
            logsEl.scrollTop = logsEl.scrollHeight;
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤
        async function copyLogs() {
            const logsEl = document.getElementById('logs');
            const text = logsEl.textContent;

            if (!text.trim()) {
                log('error', '–ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
                return;
            }

            try {
                await navigator.clipboard.writeText(text);
                log('success', 'üìã –õ–æ–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
            } catch (error) {
                log('error', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏');
            }
        }

        // –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function clearResults() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('totalTests').textContent = '0';
            document.getElementById('passedTests').textContent = '0';
            document.getElementById('failedTests').textContent = '0';
            allTestResults = [];
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞
        function updateRunButton(running) {
            const btn = document.getElementById('runBtn');
            const icon = document.getElementById('runIcon');
            const text = document.getElementById('runText');

            if (running) {
                btn.disabled = true;
                icon.innerHTML = '<span class="spinner"></span>';
                text.textContent = '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...';
            } else {
                btn.disabled = false;
                icon.textContent = '‚ñ∂';
                text.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã';
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏
        window.addEventListener('message', (event) => {
            if (event.data.type === 'test-stats') {
                document.getElementById('totalTests').textContent = event.data.total || 0;
                document.getElementById('passedTests').textContent = event.data.passed || 0;
                document.getElementById('failedTests').textContent = event.data.failed || 0;
            }
        });

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
