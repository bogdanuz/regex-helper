<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RegexHelper v4.0 - Test Runner</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            font-size: 13px;
            line-height: 1.5;
            padding: 12px;
        }
        
        .container {
            max-width: 100%;
            height: calc(100vh - 24px);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .header {
            background: #242424;
            padding: 10px 16px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 14px;
            font-weight: 600;
            color: #e0e0e0;
        }
        
        .header-stats {
            color: #888;
            font-size: 12px;
        }
        
        .main {
            display: flex;
            gap: 8px;
            flex: 1;
            overflow: hidden;
        }
        
        .left-panel {
            width: 450px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .test-list-container {
            flex: 1;
            background: #242424;
            border-radius: 6px;
            overflow-y: auto;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #2a2a2a;
            cursor: pointer;
            transition: background 0.15s;
        }
        
        .test-item:hover {
            background: #2a2a2a;
        }
        
        .test-item input[type="checkbox"] {
            margin-right: 10px;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }
        
        .test-info {
            flex: 1;
            min-width: 0;
        }
        
        .test-name {
            color: #e0e0e0;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .test-meta {
            color: #666;
            font-size: 11px;
        }
        
        .controls {
            background: #242424;
            border-radius: 6px;
            padding: 10px 12px;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .btn {
            background: #333;
            color: #e0e0e0;
            border: none;
            padding: 6px 14px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn:hover {
            background: #3a3a3a;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #4a9eff;
            color: #fff;
        }
        
        .btn-primary:hover {
            background: #5ba8ff;
        }
        
        .info {
            flex: 1;
            color: #888;
            font-size: 12px;
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .stats-bar {
            background: #242424;
            border-radius: 6px;
            padding: 10px 16px;
            display: flex;
            gap: 24px;
        }
        
        .stat {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-label {
            color: #888;
        }
        
        .stat-value {
            color: #e0e0e0;
            font-weight: 600;
            font-size: 14px;
        }
        
        .stat-value.passed {
            color: #5ec269;
        }
        
        .stat-value.failed {
            color: #ff5555;
        }
        
        .logs-container {
            flex: 1;
            background: #1f1f1f;
            border-radius: 6px;
            overflow-y: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 11px;
            padding: 12px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .logs-container:empty::before {
            content: "No logs yet...";
            color: #555;
        }
        
        .log-line {
            margin-bottom: 3px;
            line-height: 1.5;
        }
        
        .log-success {
            color: #5ec269;
        }
        
        .log-error {
            color: #ff5555;
        }
        
        .log-info {
            color: #4a9eff;
        }
        
        .log-muted {
            color: #888;
        }
        
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #444;
        }
        
        .spinner {
            display: inline-block;
            width: 10px;
            height: 10px;
            border: 2px solid #333;
            border-top-color: #4a9eff;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>RegexHelper v4.0 - Test Runner</h1>
            <div class="header-stats" id="headerStats">Ready</div>
        </div>
        
        <div class="main">
            <div class="left-panel">
                <div class="test-list-container">
                    <div id="testList"></div>
                </div>
                
                <div class="controls">
                    <button class="btn btn-primary" id="runBtn">
                        <span id="runText">Run Tests</span>
                    </button>
                    <button class="btn" id="selectAllBtn">Select All</button>
                    <button class="btn" id="clearBtn">Clear</button>
                    <button class="btn" id="copyBtn">Copy Logs</button>
                    <div class="info" id="selectedInfo">0 selected</div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="stats-bar">
                    <div class="stat">
                        <span class="stat-label">Total:</span>
                        <span class="stat-value" id="totalTests">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Passed:</span>
                        <span class="stat-value passed" id="passedTests">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Failed:</span>
                        <span class="stat-value failed" id="failedTests">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Rate:</span>
                        <span class="stat-value" id="passRate">0%</span>
                    </div>
                </div>
                
                <div class="logs-container" id="logs"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // ========================================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –¢–ï–°–¢-–°–¨–Æ–¢–û–í
        // ========================================
        const TEST_SUITES = [
            {
                id: 'global-test-suite',
                name: 'üåê –ì–õ–û–ë–ê–õ–¨–ù–´–ô –°–£–ü–ï–†-–¢–ï–°–¢',
                file: 'test-suite-global.js',
                description: '–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π: Core, Converter, Features, UI, DOM, CSS',
                estimatedTests: 155,
                version: '1.0',
                date: '2026-02-13',
                enabled: true
            }
        ];
        
        // ========================================
        // –û–°–ù–û–í–ù–û–ô –ö–û–î –¢–ï–°–¢-–†–ê–ù–ù–ï–†–ê
        // ========================================
        let selectedTests = new Set();
        let isRunning = false;
        let consoleLogBuffer = [];
        
        const sortedSuites = [...TEST_SUITES].sort((a, b) => {
            return new Date(b.date) - new Date(a.date);
        });
        
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç console.log –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = formatMessage(args);
            consoleLogBuffer.push(message);
            appendLogToUI(message, 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            const message = formatMessage(args);
            consoleLogBuffer.push('ERROR: ' + message);
            appendLogToUI('ERROR: ' + message, 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            const message = formatMessage(args);
            consoleLogBuffer.push('WARN: ' + message);
            appendLogToUI('WARN: ' + message, 'muted');
        };
        
        function formatMessage(args) {
            return args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg);
                    } catch(e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');
        }
        
        function appendLogToUI(message, type = 'info') {
            const logsEl = document.getElementById('logs');
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = message;
            logsEl.appendChild(line);
            logsEl.scrollTop = logsEl.scrollHeight;
            
            // –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            if (message.includes('FINAL:')) {
                const match = message.match(/(\d+)\/(\d+)/);
                if (match) {
                    const passed = parseInt(match[1]);
                    const total = parseInt(match[2]);
                    const failed = total - passed;
                    updateStats(total, passed, failed);
                }
            }
        }
        
        function init() {
            renderTestList();
            setupEventListeners();
            updateSelectedInfo();
        }
        
        function renderTestList() {
            const container = document.getElementById('testList');
            
            if (sortedSuites.length === 0) {
                container.innerHTML = '<div style="padding:20px;color:#666">No tests found</div>';
                return;
            }
            
            container.innerHTML = sortedSuites.map(suite => `
                <div class="test-item">
                    <input 
                        type="checkbox" 
                        id="test-${suite.id}" 
                        ${suite.enabled ? 'checked' : ''}
                        data-suite-id="${suite.id}"
                    >
                    <div class="test-info">
                        <div class="test-name">${suite.name}</div>
                        <div class="test-meta">${suite.file} ‚Ä¢ ${suite.estimatedTests} tests ‚Ä¢ v${suite.version} ‚Ä¢ ${suite.date}</div>
                    </div>
                </div>
            `).join('');
            
            // –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
            sortedSuites.forEach(suite => {
                if (suite.enabled) {
                    selectedTests.add(suite.id);
                }
            });
        }
        
        function setupEventListeners() {
            // –ß–µ–∫–±–æ–∫—Å—ã —Ç–µ—Å—Ç–æ–≤
            document.getElementById('testList').addEventListener('change', (e) => {
                if (e.target.type === 'checkbox') {
                    const suiteId = e.target.dataset.suiteId;
                    if (e.target.checked) {
                        selectedTests.add(suiteId);
                    } else {
                        selectedTests.delete(suiteId);
                    }
                    updateSelectedInfo();
                }
            });
            
            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('runBtn').addEventListener('click', runTests);
            document.getElementById('selectAllBtn').addEventListener('click', selectAll);
            document.getElementById('clearBtn').addEventListener('click', clearResults);
            document.getElementById('copyBtn').addEventListener('click', copyLogs);
        }
        
        function selectAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            
            checkboxes.forEach(cb => {
                cb.checked = !allChecked;
                const suiteId = cb.dataset.suiteId;
                if (cb.checked) {
                    selectedTests.add(suiteId);
                } else {
                    selectedTests.delete(suiteId);
                }
            });
            
            updateSelectedInfo();
        }
        
        function updateSelectedInfo() {
            const count = selectedTests.size;
            const totalTests = sortedSuites
                .filter(s => selectedTests.has(s.id))
                .reduce((sum, s) => sum + s.estimatedTests, 0);
            
            document.getElementById('selectedInfo').textContent = 
                count === 0 ? '0 selected' : `${count} files ‚Ä¢ ${totalTests} tests`;
        }
        
        async function runTests() {
            if (isRunning) return;
            
            if (selectedTests.size === 0) {
                appendLogToUI('‚ùå ERROR: No tests selected', 'error');
                return;
            }
            
            isRunning = true;
            updateRunButton(true);
            clearResults();
            consoleLogBuffer = [];
            
            const startTime = Date.now();
            document.getElementById('headerStats').textContent = 'Running...';
            
            for (const suiteId of selectedTests) {
                const suite = sortedSuites.find(s => s.id === suiteId);
                if (!suite) continue;
                
                try {
                    appendLogToUI(`\nüöÄ Loading: ${suite.name}`, 'info');
                    await import(`./tests/${suite.file}?t=${Date.now()}`);
                    appendLogToUI(`‚úÖ Loaded: ${suite.file}`, 'success');
                } catch (error) {
                    appendLogToUI(`‚ùå ERROR: Failed to load ${suite.file}: ${error.message}`, 'error');
                    originalError(error);
                }
            }
            
            const duration = Date.now() - startTime;
            document.getElementById('headerStats').textContent = `Completed in ${duration}ms`;
            
            setTimeout(() => {
                updateRunButton(false);
                isRunning = false;
            }, 500);
        }
        
        function updateStats(total, passed, failed) {
            document.getElementById('totalTests').textContent = total || 0;
            document.getElementById('passedTests').textContent = passed || 0;
            document.getElementById('failedTests').textContent = failed || 0;
            
            const rate = total > 0 ? ((passed / total) * 100).toFixed(1) : '0.0';
            document.getElementById('passRate').textContent = `${rate}%`;
        }
        
        async function copyLogs() {
            if (consoleLogBuffer.length === 0) {
                appendLogToUI('‚ùå ERROR: No logs to copy', 'error');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(consoleLogBuffer.join('\n'));
                appendLogToUI('‚úÖ Logs copied to clipboard', 'success');
            } catch (error) {
                appendLogToUI(`‚ùå ERROR: Failed to copy logs`, 'error');
            }
        }
        
        function clearResults() {
            document.getElementById('logs').innerHTML = '';
            document.getElementById('totalTests').textContent = '0';
            document.getElementById('passedTests').textContent = '0';
            document.getElementById('failedTests').textContent = '0';
            document.getElementById('passRate').textContent = '0%';
            document.getElementById('headerStats').textContent = 'Ready';
            consoleLogBuffer = [];
        }
        
        function updateRunButton(running) {
            const btn = document.getElementById('runBtn');
            const text = document.getElementById('runText');
            
            if (running) {
                btn.disabled = true;
                text.innerHTML = '<span class="spinner"></span> Running...';
            } else {
                btn.disabled = false;
                text.textContent = 'Run Tests';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        init();
    </script>
</body>
</html>
